#!/bin/sh
#######################################################################
#  $RCSfile$
#
#  Copyright (C) 2004 Novell, Inc.
#
#  This program is free software; you can redistribute it and/or
#  modify it under the terms of the GNU General Public
#  License as published by the Free Software Foundation; either
#  version 2 of the License, or (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
#  General Public License for more details.
#
#  You should have received a copy of the GNU General Public
#  License along with this program; if not, write to the Free
#  Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
#
#  Author: Paul Thomas <pthomas@novell.com>
#
#######################################################################
NAME=install-ifolder-to-gac
ARG="-i"

# Display usage statement and exit
usage()
{
    cat <<- HERE >&2
usage: $NAME [-h|--help] [-v] [-i|-u]
  OPTION:
  -i (default)  install assemblies into the gac
  -u            uninstall assemblies from the gac
  -v            verbose output
  -h, --help    display this help, then exit
HERE
}

# If VERBOSE mode, echo message
echo_v()
{
    if test -n "$VERBOSE"; then
        echo $*
    fi
}

# Output an error message
error_v()
{
    if test -n "$VERBOSE"; then
        echo $* >&2
    fi
}

# If VERBOSE mode, display variable=value before
# setting variable $1 to value $2
setvar_v()
{
    echo_v $1=$2
    eval $1=\"$2\"
    if ! test "$?" = "0"; then exit 0; fi
}

echo_v "0=$0, 1=$1, *=$*"

# Check for help option
if test "$1" = "-h" -o "$1" = "--help"
then
    usage
    exit 0
fi

# Check for verbose mode
if test "$1" = "-v"
then
    VERBOSE=1
    shift
fi

# Check for install option
if test "$1" = "-i"
then
    ARG="-i"
    shift
fi

# Check for uninstall option
if test "$1" = "-u"
then
    ARG="-u"
    shift
fi

echo_v "ARG = $ARG"

#
# Copy log4net.dll to /usr/lib
# TODO: log4net.dll should be put in the gac when we get a signed version
#
if test "$ARG" = "-i"
then
    echo_v "cp -f @prefix@/lib/log4net.dll /usr/lib"
    cp -f @prefix@/lib/log4net.dll /usr/lib || exit 1
else
    echo_v "rm -f /usr/lib/log4net.dll"
    rm -f /usr/lib/log4net.dll
fi

#
# Install assemblies into the gac
#
for assembly in Novell.iFolder.dll
do
    if test "$ARG" = "-i"
    then
        echo_v "gacutil $ARG @prefix@/lib/$assembly"
        if test -n "$VERBOSE"
        then
            gacutil $ARG @prefix@/lib/$assembly || exit 1
        else
            gacutil $ARG @prefix@/lib/$assembly > /dev/null 2>&1 || exit 1
        fi
    else
        assembly=`basename $assembly .dll`
        echo_v "gacutil $ARG $assembly"
        if test -n "$VERBOSE"
        then
            gacutil $ARG $assembly
        else
            gacutil $ARG $assembly > /dev/null 2>&1
        fi
    fi
done

exit 0

